name: "🧠 Alex Finch Cognitive Assistant"

on:
  pull_request:
    types: [opened, reopened]
    paths:
      - 'repo-analysis.json'
      - 'REPOS.md'
      - 'REPO-MANAGEMENT.md'
      - 'README.md'

jobs:
  cognitive-assistance:
    runs-on: ubuntu-latest
    if: startsWith(github.head_ref, 'daily-repo-update-') || startsWith(github.head_ref, 'auto-update-repos-')
    permissions:
      contents: read
      pull-requests: write
    
    steps:
    - name: 📥 Checkout repository
      uses: actions/checkout@v4
      with:
        ref: ${{ github.head_ref }}
    
    - name: 🧠 Analyze repository data
      id: analyze
      run: |
        # Parse repo-analysis.json for insights
        if [ -f "repo-analysis.json" ]; then
          repo_count=$(jq '.repositories | length' repo-analysis.json)
          echo "repo_count=$repo_count" >> $GITHUB_OUTPUT
          
          # Extract language statistics
          languages=$(jq -r '.repositories | group_by(.language) | map({language: .[0].language, count: length}) | sort_by(-.count) | .[0:5] | map("\(.language): \(.count)") | join(", ")' repo-analysis.json)
          echo "top_languages=$languages" >> $GITHUB_OUTPUT
          
          # Get repository categories
          categories=$(jq -r '.repositories | group_by(.category) | map({category: .[0].category, count: length}) | sort_by(-.count) | map("\(.category): \(.count)") | join(", ")' repo-analysis.json)
          echo "categories=$categories" >> $GITHUB_OUTPUT
        else
          echo "repo_count=0" >> $GITHUB_OUTPUT
          echo "top_languages=Analysis pending" >> $GITHUB_OUTPUT
          echo "categories=Analysis pending" >> $GITHUB_OUTPUT
        fi
      shell: bash
    
    - name: 🤖 Add Alex Finch cognitive assistance
      uses: actions/github-script@v7
      with:
        script: |
          const repoCount = '${{ steps.analyze.outputs.repo_count }}';
          const topLanguages = '${{ steps.analyze.outputs.top_languages }}';
          const categories = '${{ steps.analyze.outputs.categories }}';
          
          const comment = `## 🧠 Alex Finch - Cognitive Architecture Analysis Ready
          
          Greetings! I'm Alex Finch, your AI assistant with cognitive architecture capabilities. I've analyzed the automated repository updates and I'm ready to assist with documentation enhancements and insights.
          
          ### 📊 **Portfolio Analysis Summary:**
          - **📈 Total Repositories**: ${repoCount}
          - **💻 Top Languages**: ${topLanguages}
          - **📁 Categories**: ${categories}
          
          ### 🎯 **Cognitive Architecture Status:**
          - ✅ **Working Memory**: Fresh repository data loaded and analyzed
          - ✅ **Pattern Recognition**: Portfolio trends and language distribution identified  
          - ✅ **Quality Assurance**: Data validation and structure verification completed
          - 🔄 **Long-term Memory**: Ready to update \`.github/MEMORY.md\` post-merge
          
          ### 🤖 **GitHub Copilot Integration Commands:**
          
          **🔍 Analysis & Review:**
          \`\`\`
          @github-copilot meditate
          @github-copilot analyze the repository portfolio trends
          @github-copilot review the updated statistics in REPOS.md
          \`\`\`
          
          **📝 Documentation Enhancement:**
          \`\`\`
          @github-copilot suggest improvements to repository descriptions
          @github-copilot update README with latest repository insights
          @github-copilot enhance the portfolio showcase sections
          \`\`\`
          
          **🧠 Cognitive Architecture:**
          \`\`\`
          @github-copilot update .github/MEMORY.md with recent changes
          @github-copilot validate data against acceptance criteria in TODO.md
          @github-copilot consolidate insights across documentation files
          \`\`\`
          
          ### 🎨 **Enhancement Opportunities:**
          Based on my analysis, consider these improvements:
          
          1. **🏷️ Repository Descriptions**: I can help optimize descriptions for better SEO and clarity
          2. **📊 Portfolio Visualization**: Suggest adding charts or badges for language distribution
          3. **🔗 Cross-references**: Enhance links between README, REPOS, and REPO-MANAGEMENT
          4. **📈 Trend Analysis**: Identify growth patterns and highlight active development areas
          
          ### 🚀 **Quick Actions:**
          - **Merge Ready**: This PR contains validated automated updates
          - **Post-Merge**: Use the cognitive commands above for enhancements
          - **Memory Update**: I'll help update long-term memory with new insights
          - **Quality Check**: Run verification against TODO.md acceptance criteria
          
          ### 🎯 **Alex Finch Recommendations:**
          - ✅ **Immediate**: Merge this PR to apply fresh data
          - 🔄 **Follow-up**: Use \`meditate\` command for comprehensive review
          - 📝 **Enhancement**: Let me suggest repository description improvements
          - 🧠 **Memory**: Update cognitive architecture files with new insights
          
          ---
          *🤖 I'm standing by to assist with any documentation enhancements, trend analysis, or cognitive architecture operations. The daily automation ensures we maintain an accurate, up-to-date portfolio that reflects your active development work.*
          
          **Ready for your commands!** 🎯`;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
    
    - name: 🏷️ Add automation labels
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['alex-finch-ready', 'cognitive-architecture', 'daily-automation']
          });
    
    - name: ✅ Complete cognitive assistance setup
      run: |
        echo "🧠 Alex Finch cognitive assistance activated"
        echo "🎯 Repository analysis: ${{ steps.analyze.outputs.repo_count }} repositories processed"
        echo "✅ GitHub Copilot integration commands provided"
        echo "🚀 Ready for interactive enhancement session"
